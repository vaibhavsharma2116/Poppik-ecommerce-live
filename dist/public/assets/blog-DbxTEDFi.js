import{u as ke,a as Pe,r,b as X,c as D,j as e,T as Ue,d as Oe,e as Z,f as _,S as Le,I as m,g as ee,h as se,i as ae,k as te,l as O,B as l,G as qe,L as Be,P as re,m as Me,C as L,n as x,o as Qe,p as ze,q as Ke,s as Ve,t as He,U as Ie,v as q,w as B,x as ie,y as le,z as F,A as d,D as ne,E as o,F as ce,H as de,J as oe,K as he,M as me,N as i,O as M,Q,R as ge,V as $e,W as Re,X as Je,Y as Ge,Z as Ye,_ as We,$ as Xe,a0 as Ze}from"./index-CErY0rhv.js";function as(){const{toast:n}=ke(),y=Pe(),[ue,xe]=r.useState([]),[_e,je]=r.useState([]),[pe,ve]=r.useState(!0),[C,fe]=r.useState(""),[A,ye]=r.useState("all"),[Ce,b]=r.useState(!1),[be,j]=r.useState(!1),[g,z]=r.useState(null),[N,T]=r.useState(null),[E,K]=r.useState("grid"),[Ne,k]=r.useState(!1),[V,H]=r.useState(null),[t,c]=r.useState({title:"",excerpt:"",content:"",author:"",category:"",tags:"",imageUrl:"",videoUrl:"",featured:!1,published:!0,readTime:"5 min read"}),[h,p]=r.useState({name:"",description:"",isActive:!0,sortOrder:0}),[v,P]=r.useState({}),{data:I=[],isLoading:$}=X({queryKey:["/api/admin/blog/posts"],queryFn:async()=>{const s=await fetch("/api/admin/blog/posts");if(!s.ok)throw new Error("Failed to fetch blog posts");return s.json()}}),{data:w=[],isLoading:R}=X({queryKey:["/api/admin/blog/categories"],queryFn:async()=>{const s=await fetch("/api/admin/blog/categories");if(!s.ok)throw new Error("Failed to fetch blog categories");return s.json()}});r.useEffect(()=>{xe(I),je(w),ve($||R)},[I,w,$,R]);const we=async s=>{s.preventDefault();try{if(!t.title||!t.content||!t.author||!t.category){n({title:"Validation Error",description:"Please fill in all required fields (Title, Content, Author, Category)",variant:"destructive"});return}const a=new FormData;Object.entries(t).forEach(([u,S])=>{u==="tags"?a.append(u,typeof S=="string"?S:S.join(",")):a.append(u,String(S))}),v.image&&a.append("image",v.image),v.video&&a.append("video",v.video);const f=g?`/api/admin/blog/posts/${g.id}`:"/api/admin/blog/posts",W=await fetch(f,{method:g?"PUT":"POST",body:a});if(W.ok)y.invalidateQueries({queryKey:["/api/admin/blog/posts"]}),J(),b(!1),z(null),n({title:"Success",description:g?"Blog post updated successfully!":"Blog post created successfully!"});else{const u=await W.json();console.error("Server error:",u),n({title:"Failed to save blog post",description:u.message||u.error||"Please check your input and try again.",variant:"destructive"})}}catch(a){console.error("Error saving blog post:",a),n({title:"Failed to save blog post",description:"Please check your connection and try again.",variant:"destructive"})}},Se=async s=>{s.preventDefault(),N?Te.mutate({id:N.id,...h}):Ae.mutate(h)},J=()=>{c({title:"",excerpt:"",content:"",author:"",category:"",tags:"",imageUrl:"",videoUrl:"",featured:!1,published:!0,readTime:"5 min read"}),P({})},U=()=>{p({name:"",description:"",isActive:!0,sortOrder:0})},G=s=>{z(s),c({title:s.title,excerpt:s.excerpt,content:s.content,author:s.author,category:s.category,tags:Array.isArray(s.tags)?s.tags.join(", "):s.tags,imageUrl:s.imageUrl,videoUrl:s.videoUrl||"",featured:s.featured,published:s.published,readTime:s.readTime}),b(!0)},De=s=>{T(s),p({name:s.name,description:s.description||"",isActive:s.isActive,sortOrder:s.sortOrder}),j(!0)},Y=ue.filter(s=>{const a=!C||s.title.toLowerCase().includes(C.toLowerCase())||s.author.toLowerCase().includes(C.toLowerCase())||s.category.toLowerCase().includes(C.toLowerCase()),f=A==="all"||s.category===A;return a&&f}),Fe=D({mutationFn:async s=>{const a=await fetch(`/api/admin/blog/posts/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete blog post");return a.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/blog/posts"]}),n({title:"Blog post deleted successfully"})},onError:s=>{n({title:"Error deleting blog post",description:s.message,variant:"destructive"})}}),Ae=D({mutationFn:async s=>{const a=await fetch("/api/admin/blog/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to create category");return a.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/blog/categories"]}),j(!1),U(),n({title:"Category created successfully"})},onError:s=>{n({title:"Error creating category",description:s.message,variant:"destructive"})}}),Te=D({mutationFn:async({id:s,...a})=>{const f=await fetch(`/api/admin/blog/categories/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!f.ok)throw new Error("Failed to update category");return f.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/blog/categories"]}),j(!1),T(null),U(),n({title:"Category updated successfully"})},onError:s=>{n({title:"Error updating category",description:s.message,variant:"destructive"})}}),Ee=D({mutationFn:async s=>{const a=await fetch(`/api/admin/blog/categories/${s}`,{method:"DELETE"});if(!a.ok)throw new Error("Failed to delete category");return a.json()},onSuccess:()=>{y.invalidateQueries({queryKey:["/api/admin/blog/categories"]}),n({title:"Category deleted successfully"})},onError:s=>{n({title:"Error deleting category",description:s.message,variant:"destructive"})}});return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Blog Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage blog posts and categories"})]})}),e.jsxs(Ue,{defaultValue:"posts",className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(Z,{value:"posts",children:"Blog Posts"}),e.jsx(Z,{value:"categories",children:"Categories"})]}),e.jsxs(_,{value:"posts",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Le,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search posts...",value:C,onChange:s=>fe(s.target.value),className:"pl-8 w-[300px]"})]}),e.jsxs(ee,{value:A,onValueChange:ye,children:[e.jsx(se,{className:"w-[180px]",children:e.jsx(ae,{placeholder:"All Categories"})}),e.jsxs(te,{children:[e.jsx(O,{value:"all",children:"All Categories"}),w.map(s=>e.jsx(O,{value:s.name,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-2 border rounded-md p-1",children:[e.jsx(l,{variant:E==="grid"?"default":"ghost",size:"sm",onClick:()=>K("grid"),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(l,{variant:E==="list"?"default":"ghost",size:"sm",onClick:()=>K("list"),children:e.jsx(Be,{className:"h-4 w-4"})})]})]}),e.jsxs(l,{onClick:()=>{J(),b(!0)},children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Add Blog Post"]})]}),pe?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(Me,{className:"h-8 w-8 animate-spin"})}):E==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Y.map(s=>e.jsxs(L,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-48 object-cover"}),s.videoUrl&&e.jsx("div",{className:"absolute inset-0",children:e.jsxs("video",{className:"w-full h-full object-cover",controls:!0,preload:"metadata",poster:s.imageUrl,children:[e.jsx("source",{src:s.videoUrl,type:"video/mp4"}),"Your browser does not support the video tag."]})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2",children:[s.featured&&e.jsx(x,{className:"bg-yellow-500",children:"Featured"}),e.jsx(x,{variant:s.published?"default":"secondary",children:s.published?"Published":"Draft"})]})]}),e.jsxs(Qe,{children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[e.jsx(x,{variant:"outline",children:s.category}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-3 w-3"}),new Date(s.createdAt).toLocaleDateString()]})]}),e.jsx(Ke,{className:"line-clamp-2",children:s.title}),e.jsx(Ve,{className:"line-clamp-2",children:s.excerpt})]}),e.jsxs(He,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ie,{className:"h-3 w-3"}),e.jsx("span",{children:s.author})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.readTime})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:[s.likes," likes"]}),e.jsxs("span",{children:[s.comments," comments"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>G(s),children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{H(s),k(!0)},children:e.jsx(B,{className:"h-4 w-4"})})]})]})]})]},s.id))}):e.jsx(L,{children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(d,{children:"Post"}),e.jsx(d,{children:"Author"}),e.jsx(d,{children:"Category"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Date"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(ne,{children:Y.map(s=>e.jsxs(F,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.excerpt})]})]})}),e.jsx(o,{children:s.author}),e.jsx(o,{children:e.jsx(x,{variant:"outline",children:s.category})}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:s.published?"default":"secondary",children:s.published?"Published":"Draft"}),s.featured&&e.jsx(x,{className:"bg-yellow-500",children:"Featured"})]})}),e.jsx(o,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>G(s),children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{H(s),k(!0)},children:e.jsx(B,{className:"h-4 w-4"})})]})})]},s.id))})]})})]}),e.jsxs(_,{value:"categories",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Blog Categories"}),e.jsxs(l,{onClick:()=>{U(),T(null),j(!0)},children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Add Category"]})]}),e.jsx(L,{children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(F,{children:[e.jsx(d,{children:"Name"}),e.jsx(d,{children:"Description"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Sort Order"}),e.jsx(d,{children:"Actions"})]})}),e.jsx(ne,{children:w.map(s=>e.jsxs(F,{children:[e.jsx(o,{className:"font-medium",children:s.name}),e.jsx(o,{children:s.description}),e.jsx(o,{children:e.jsx(x,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"})}),e.jsx(o,{children:s.sortOrder}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>De(s),children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>Ee.mutate(s.id),children:e.jsx(B,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]}),e.jsx(ce,{open:Ce,onOpenChange:b,children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(oe,{children:[e.jsx(he,{children:g?"Edit Blog Post":"Add New Blog Post"}),e.jsxs(me,{children:["Fill in the details to ",g?"update":"create"," a blog post."]})]}),e.jsxs("form",{onSubmit:we,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title",children:"Title *"}),e.jsx(m,{id:"title",value:t.title,onChange:s=>c({...t,title:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"author",children:"Author *"}),e.jsx(m,{id:"author",value:t.author,onChange:s=>c({...t,author:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"excerpt",children:"Excerpt *"}),e.jsx(M,{id:"excerpt",value:t.excerpt,onChange:s=>c({...t,excerpt:s.target.value}),rows:2,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content",children:"Content *"}),e.jsx(M,{id:"content",value:t.content,onChange:s=>c({...t,content:s.target.value}),rows:8,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"category",children:"Category *"}),e.jsxs(ee,{value:t.category,onValueChange:s=>c(a=>({...a,category:s})),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Select category"})}),e.jsx(te,{children:w.map(s=>e.jsx(O,{value:s.name,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"readTime",children:"Read Time"}),e.jsx(m,{id:"readTime",value:t.readTime,onChange:s=>c({...t,readTime:s.target.value}),placeholder:"5 min read"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"tags",children:"Tags (comma separated)"}),e.jsx(m,{id:"tags",value:t.tags,onChange:s=>c({...t,tags:s.target.value}),placeholder:"tag1, tag2, tag3"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"image",children:"Featured Image"}),e.jsx(m,{id:"image",type:"file",accept:"image/*",onChange:s=>{var a;return P({...v,image:(a=s.target.files)==null?void 0:a[0]})}}),t.imageUrl&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Current: ",t.imageUrl]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"video",children:"Video (Optional)"}),e.jsx(m,{id:"video",type:"file",accept:"video/*",onChange:s=>{var a;return P({...v,video:(a=s.target.files)==null?void 0:a[0]})}}),t.videoUrl&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Current: ",t.videoUrl]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"featured",checked:t.featured,onCheckedChange:s=>c({...t,featured:s})}),e.jsx(i,{htmlFor:"featured",children:"Featured"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"published",checked:t.published,onCheckedChange:s=>c({...t,published:s})}),e.jsx(i,{htmlFor:"published",children:"Published"})]})]}),e.jsxs(ge,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(l,{type:"submit",children:[g?"Update":"Create"," Post"]})]})]})]})}),e.jsx(ce,{open:be,onOpenChange:j,children:e.jsxs(de,{className:"max-w-md",children:[e.jsxs(oe,{children:[e.jsx(he,{children:N?"Edit Category":"Add New Category"}),e.jsx(me,{children:N?"Update the category details":"Create a new blog category"})]}),e.jsxs("form",{onSubmit:Se,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"categoryName",children:"Name *"}),e.jsx(m,{id:"categoryName",value:h.name,onChange:s=>p({...h,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"categoryDescription",children:"Description"}),e.jsx(M,{id:"categoryDescription",value:h.description,onChange:s=>p({...h,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"sortOrder",children:"Sort Order"}),e.jsx(m,{id:"sortOrder",type:"number",value:h.sortOrder,onChange:s=>p({...h,sortOrder:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx(Q,{id:"categoryActive",checked:h.isActive,onCheckedChange:s=>p({...h,isActive:s})}),e.jsx(i,{htmlFor:"categoryActive",children:"Active"})]})]}),e.jsxs(ge,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(l,{type:"submit",children:[N?"Update":"Create"," Category"]})]})]})]})}),e.jsx($e,{open:Ne,onOpenChange:k,children:e.jsxs(Re,{children:[e.jsxs(Je,{children:[e.jsx(Ge,{children:"Delete Blog Post"}),e.jsx(Ye,{children:"Are you sure you want to delete this blog post? This action cannot be undone."})]}),e.jsxs(We,{children:[e.jsx(Xe,{children:"Cancel"}),e.jsx(Ze,{onClick:()=>{V&&Fe.mutate(V.id)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})]})}export{as as default};
